<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameRenderer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gdx-2dgame</a> &gt; <a href="index.source.html" class="el_package">inf112.core.app.View</a> &gt; <span class="el_source">GameRenderer.java</span></div><h1>GameRenderer.java</h1><pre class="source lang-java linenums">package inf112.core.app.View;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.graphics.GL20;
import com.badlogic.gdx.graphics.OrthographicCamera;
import com.badlogic.gdx.graphics.g2d.Batch;
import com.badlogic.gdx.maps.tiled.renderers.OrthogonalTiledMapRenderer;
import com.badlogic.gdx.physics.box2d.Box2DDebugRenderer;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.utils.viewport.FitViewport;
import com.badlogic.gdx.utils.viewport.Viewport;

import inf112.core.app.Main;
import inf112.core.app.MainGame;
import inf112.core.app.Characters.IEnemy;
import inf112.core.app.Characters.IProjectile;
import inf112.core.app.Model.IGameModel;
import inf112.core.app.PopUpItems.IPopUpItem;
import inf112.core.app.View.GameScreens.IHud;
import inf112.core.app.View.GameScreens.PowerupText;

/**
 * The Class GameRenderer.
 * The view part of the Model-view-controller.
 */
public class GameRenderer implements IGameRenderer {

// Model
private IGameModel model;

// Screen variables
private Viewport viewport;
private OrthographicCamera cam;
private Batch batch;

// Tiled level variables
private OrthogonalTiledMapRenderer tiledmaprenderer;

// Box2d
private Box2DDebugRenderer b2dr;

// Listener variables
public Stage stage;

// Hud
private IHud hud;

// Powerup active screen
private PowerupText powerupText;


/**
 * Instantiates a new game renderer.
 *
 * @param model the model
 * @param batch the batch
 * @param hud the hud
 */
<span class="nc" id="L59">public GameRenderer(IGameModel model, Batch batch, IHud hud) {</span>
	 // Set initial parameters
<span class="nc" id="L61">    this.model = model;</span>
<span class="nc" id="L62">    this.batch = batch;</span>
<span class="nc" id="L63">    this.hud = hud;</span>
	 
	// Set Powerup active screen
<span class="nc" id="L66">	powerupText = new PowerupText(batch);</span>

    // Camera for following the player
    // Viewport for setting aspect ratio despire screen size
<span class="nc" id="L70">    cam = new OrthographicCamera();</span>
<span class="nc" id="L71">    viewport = new FitViewport(Main.WINDOW_WIDTH / MainGame.PPM, Main.WINDOW_HEIGHT / MainGame.PPM, cam);</span>
<span class="nc" id="L72">    viewport.apply(); // Not sure if necessary</span>
    
	// Render map
<span class="nc" id="L75">    tiledmaprenderer = new OrthogonalTiledMapRenderer(model.getMap(), 1 / MainGame.PPM);</span>
	
    // Setting camera start position
<span class="nc" id="L78">	cam.position.set(0, viewport.getWorldHeight()/2, 0);</span>
<span class="nc" id="L79">	cam.update();</span>
<span class="nc" id="L80"> }</span>


 @Override
public void render() {	
     	// Set camera x position to player coordinates and update
<span class="nc" id="L86">	 	cam.position.x = model.getPlayer().getBody().getPosition().x;</span>
<span class="nc" id="L87">	 	cam.update();</span>
   
		// Clear screen.
<span class="nc" id="L90">		Gdx.gl.glClearColor(0, 0, 0, 0);;</span>
<span class="nc" id="L91">		Gdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);</span>

		// Draw tile map
<span class="nc" id="L94">		tiledmaprenderer.setView(cam);</span>
<span class="nc" id="L95">		tiledmaprenderer.render();</span>
		
		// Draw player
<span class="nc" id="L98">		batch.setProjectionMatrix(cam.combined);</span>
<span class="nc" id="L99">		batch.begin();  </span>
<span class="nc" id="L100">		model.getPlayer().draw(batch);</span>
		
		// Draw enemies
<span class="nc bnc" id="L103" title="All 2 branches missed.">		for(IEnemy enemy : model.getCreator().getEnemies())</span>
<span class="nc" id="L104">	 		enemy.draw(batch);</span>
		
		// Draw pop-up-items
<span class="nc bnc" id="L107" title="All 2 branches missed.">		for(IPopUpItem popUpItem : model.getPopUpItems()) {</span>
<span class="nc" id="L108">			popUpItem.draw(batch);</span>
<span class="nc" id="L109">		}</span>
			
		// Draw bullets
<span class="nc bnc" id="L112" title="All 2 branches missed.">	    if (model.getBullets() != null) {</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">	    	for(IProjectile bullet : model.getBullets())</span>
<span class="nc" id="L114">	    		bullet.draw(batch);</span>
		    }	    

<span class="nc" id="L117">	    batch.end();</span>

		// Draw hud
<span class="nc" id="L120">		batch.setProjectionMatrix(hud.getStage().getCamera().combined);</span>
<span class="nc" id="L121">		hud.getStage().draw();</span>

		// Draw Powerup
<span class="nc" id="L124">		batch.setProjectionMatrix(powerupText.stage.getCamera().combined);</span>
<span class="nc bnc" id="L125" title="All 4 branches missed.">		if(model.getPlayer().isShootActive() &amp;&amp; !model.getPlayer().isCheatShootActive()){</span>
<span class="nc" id="L126">			powerupText.update(model.getPlayer().getSingleLightningTimeout());</span>
<span class="nc" id="L127">			powerupText.stage.draw();</span>
		}
<span class="nc" id="L129"> }</span>
 
@Override
public void resize(int width, int height) {
		// Resize viewport and reposition camera.
<span class="nc" id="L134">		viewport.update(width,  height);</span>
<span class="nc" id="L135">	    cam.position.set(cam.viewportWidth/2,cam.viewportHeight/2,0);</span>
<span class="nc" id="L136">	    cam.update();		  		</span>
<span class="nc" id="L137">	}</span>

@Override
public void dispose() {
<span class="nc" id="L141">		model.getMap().dispose();</span>
<span class="nc" id="L142">		tiledmaprenderer.dispose();</span>
<span class="nc" id="L143">		batch.dispose();</span>
<span class="nc" id="L144"> }</span>

@Override
public Stage getStage() {
<span class="nc" id="L148">	return stage;</span>
}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>