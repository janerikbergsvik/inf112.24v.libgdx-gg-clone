<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ObjectListener.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gdx-2dgame</a> &gt; <a href="index.source.html" class="el_package">inf112.core.app.Helper</a> &gt; <span class="el_source">ObjectListener.java</span></div><h1>ObjectListener.java</h1><pre class="source lang-java linenums">package inf112.core.app.Helper;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.physics.box2d.Contact;
import com.badlogic.gdx.physics.box2d.ContactImpulse;
import com.badlogic.gdx.physics.box2d.ContactListener;
import com.badlogic.gdx.physics.box2d.Fixture;
import com.badlogic.gdx.physics.box2d.Manifold;

import inf112.core.app.Characters.IEnemy;
import inf112.core.app.Characters.IPlayer;
import inf112.core.app.Model.IGameModel;
import inf112.core.app.PopUpItems.IPopUpItem;
import inf112.core.app.TileObjects.ITileObject;
import inf112.core.app.TileObjects.TileObject;

/**
 * The listener interface for receiving object events.
 * The class that is interested in processing a object
 * event implements this interface, and the object created
 * with that class is registered with a component using the
 * component's &lt;code&gt;addObjectListener&lt;/code&gt; method. When
 * the object event occurs, that object's appropriate
 * method is invoked.
 *
 * @see ObjectEvent
 */
<span class="fc" id="L28">public class ObjectListener implements ContactListener {</span>

	/**
	 * Identify fixture corresponding to bodypart.
	 *
	 * @param contact the contact
	 * @param bodyPart the body part
	 * @return the fixture corresponding to body part
	 */
	private Fixture identifyFixture(Contact contact, String bodyPart){
<span class="fc" id="L38">		Fixture fixtureA = contact.getFixtureA();</span>
<span class="fc" id="L39">		Fixture fixtureB = contact.getFixtureB();</span>
<span class="fc" id="L40">		Fixture object = null;</span>

<span class="pc bpc" id="L42" title="1 of 2 branches missed.">		if (fixtureA.getUserData() == bodyPart) {</span>
<span class="nc" id="L43">			object = fixtureB;</span>
		}
		
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">		else if (fixtureB.getUserData() == bodyPart) {</span>
<span class="nc" id="L47">			object = fixtureA;</span>
		}
		
<span class="fc" id="L50">		return object;</span>
	}
		
	@Override
	public void beginContact(Contact contact) {						
<span class="fc" id="L55">		checkHeadAndFeetContact(contact);	</span>
<span class="fc" id="L56">		checkEntityContacts(contact); 		</span>
<span class="fc" id="L57">	}</span>

	/**
	 * Check entity contacts.
	 *
	 * @param contact the contact
	 */
	private void checkEntityContacts(Contact contact) {
<span class="fc" id="L65">		Fixture fixtureA = contact.getFixtureA();</span>
<span class="fc" id="L66">		Fixture fixtureB = contact.getFixtureB();</span>
		
		// Identify contact between fixtures.
<span class="fc" id="L69">		int contactDef = fixtureA.getFilterData().categoryBits | fixtureB.getFilterData().categoryBits;		</span>
		
		// Identify contact between bits.
		try {
	
<span class="pc bpc" id="L74" title="7 of 10 branches missed.">		switch(contactDef){		</span>
			// If contact between finish game object and giana body.
			case IGameModel.FINISH_GAME_BIT | IGameModel.GIANA_BIT:
<span class="nc bnc" id="L77" title="All 2 branches missed.">				if(fixtureA.getFilterData().categoryBits == IGameModel.FINISH_GAME_BIT)</span>
<span class="nc" id="L78">					((ITileObject)fixtureA.getUserData()).onPlayerContact();</span>
				else
<span class="nc" id="L80">					((ITileObject)fixtureB.getUserData()).onPlayerContact();</span>
<span class="nc" id="L81">				break;</span>
		 
			// If contact between giana body and coin
			case IGameModel.COIN_BIT | IGameModel.GIANA_BIT:
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">				if(fixtureA.getFilterData().categoryBits == IGameModel.COIN_BIT)</span>
<span class="fc" id="L86">					((ITileObject)fixtureA.getUserData()).onPlayerContact();</span>
				else
<span class="nc" id="L88">					((ITileObject)fixtureB.getUserData()).onPlayerContact();</span>
<span class="nc" id="L89">				break;</span>
	
			// If contact between giana and enemy head, remove enemy
			case IGameModel.ENEMY_HEAD_BIT | IGameModel.GIANA_BIT:
<span class="nc bnc" id="L93" title="All 2 branches missed.">				if(fixtureA.getFilterData().categoryBits == IGameModel.ENEMY_HEAD_BIT)</span>
<span class="nc" id="L94">					((IEnemy)fixtureA.getUserData()).hitOnHead();</span>
				else
<span class="nc" id="L96">					((IEnemy)fixtureB.getUserData()).hitOnHead();</span>
<span class="nc" id="L97">				break;</span>
				
			// If contact between enemy and wall, turn around
			case IGameModel.ENEMY_BIT | IGameModel.OBJECT_BIT:
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">				if(fixtureA.getFilterData().categoryBits == IGameModel.ENEMY_BIT)</span>
<span class="nc" id="L102">					((IEnemy)fixtureA.getUserData()).reverseVelocity(true, false);</span>
				else
<span class="fc" id="L104">					((IEnemy)fixtureB.getUserData()).reverseVelocity(true, false);</span>
<span class="fc" id="L105">				break;</span>
		
				// If contact between giana and enemy, giana died
				case IGameModel.GIANA_BIT | IGameModel.ENEMY_BIT:
<span class="nc bnc" id="L109" title="All 2 branches missed.">					if(fixtureA.getFilterData().categoryBits == IGameModel.GIANA_BIT) {</span>
<span class="nc" id="L110">						int damage = ((IEnemy)fixtureB.getUserData()).getDamage();</span>
<span class="nc" id="L111">						((IPlayer)fixtureA.getUserData()).applyHealthChange(damage);</span>
<span class="nc" id="L112">						((IEnemy)fixtureB.getUserData()).reverseVelocity(true, false);</span>
<span class="nc" id="L113">					}</span>
					else {
<span class="nc" id="L115">						int damage = ((IEnemy)fixtureA.getUserData()).getDamage();</span>
<span class="nc" id="L116">						((IPlayer)fixtureB.getUserData()).applyHealthChange(damage);</span>
<span class="nc" id="L117">						((IEnemy)fixtureA.getUserData()).reverseVelocity(true, false);</span>
					}
<span class="nc" id="L119">					Gdx.app.log(&quot;Giana got damaged.&quot;, &quot;&quot;);				</span>
<span class="nc" id="L120">					break;</span>
				
			// If contact between enemy and enemy, turn both around
			case IGameModel.ENEMY_BIT | IGameModel.ENEMY_BIT:
<span class="fc" id="L124">					((IEnemy)fixtureA.getUserData()).reverseVelocity(true, false);</span>
<span class="fc" id="L125">					((IEnemy)fixtureB.getUserData()).reverseVelocity(true, false);</span>
<span class="fc" id="L126">					break;</span>
	
			// If contact between enemy and bullet.
			case IGameModel.ENEMY_BIT | IGameModel.BULLET_BIT:
<span class="nc bnc" id="L130" title="All 2 branches missed.">					if(fixtureA.getFilterData().categoryBits == IGameModel.ENEMY_BIT)</span>
<span class="nc" id="L131">						((IEnemy)fixtureA.getUserData()).hitOnHead();</span>
					else
<span class="nc" id="L133">						((IEnemy)fixtureB.getUserData()).hitOnHead();</span>
<span class="nc" id="L134">					break;</span>
			
			// If contact between popupitem and objects, turn around
			case IGameModel.POPUP_ITEM_BIT | IGameModel.OBJECT_BIT:
<span class="nc bnc" id="L138" title="All 2 branches missed.">					if(fixtureA.getFilterData().categoryBits == IGameModel.POPUP_ITEM_BIT)</span>
<span class="nc" id="L139">						((IPopUpItem)fixtureA.getUserData()).reverseVelocity(true, false);</span>
					else
<span class="nc" id="L141">						((IPopUpItem)fixtureB.getUserData()).reverseVelocity(true, false);</span>
<span class="nc" id="L142">					break;</span>
	
			// If contact between popupitem and Giana sister, then pick-up item
			case IGameModel.POPUP_ITEM_BIT | IGameModel.GIANA_BIT:
<span class="nc bnc" id="L146" title="All 2 branches missed.">					if(fixtureA.getFilterData().categoryBits == IGameModel.POPUP_ITEM_BIT)</span>
<span class="nc" id="L147">						((IPopUpItem)fixtureA.getUserData()).use();</span>
					else
<span class="nc" id="L149">						((IPopUpItem)fixtureB.getUserData()).use();</span>
<span class="nc" id="L150">					break;</span>
			
			default:
<span class="nc" id="L153">				Gdx.app.log(&quot;No contact identified.&quot;, &quot;&quot;);</span>
			}
		
<span class="nc" id="L156">	    } catch (Exception e) {</span>
<span class="nc" id="L157">		      Gdx.app.log(&quot;Error in Objectlistener.java&quot;, &quot;&quot;);</span>
<span class="fc" id="L158">		    }</span>
<span class="fc" id="L159">	}</span>

	/**
	 * Check head and feet contact.
	 *
	 * @param contact the contact
	 */
	private void checkHeadAndFeetContact(Contact contact) {		
		Fixture object;
		// If contact between player hair and object.
<span class="fc" id="L169">		object = identifyFixture(contact, &quot;hair&quot;);</span>
<span class="pc bpc" id="L170" title="5 of 6 branches missed.">		if(object != null &amp;&amp; object.getUserData() != null &amp;&amp; TileObject.class.isAssignableFrom(object.getUserData().getClass())) {</span>
<span class="nc" id="L171">				((ITileObject) object.getUserData()).onHairContact();</span>
		}	
		
		// If contact between player feet and object.
<span class="fc" id="L175">		object = identifyFixture(contact, &quot;feet&quot;);</span>
<span class="pc bpc" id="L176" title="5 of 6 branches missed.">		if(object != null &amp;&amp; object.getUserData() != null &amp;&amp; TileObject.class.isAssignableFrom(object.getUserData().getClass())) {</span>
<span class="nc" id="L177">				((ITileObject) object.getUserData()).onFeetContact();</span>
			}
<span class="fc" id="L179">	}</span>

	@Override
	public void endContact(Contact contact) {		
		Fixture object;
		
		// If contact between player feet and object ends.
<span class="nc" id="L186">		object = identifyFixture(contact, &quot;feet&quot;);</span>
<span class="nc bnc" id="L187" title="All 6 branches missed.">		if(object != null &amp;&amp; object.getUserData() != null &amp;&amp; TileObject.class.isAssignableFrom(object.getUserData().getClass())) {</span>
<span class="nc" id="L188">				((ITileObject) object.getUserData()).onFeetContactEnd();</span>
			}			
<span class="nc" id="L190">	}</span>

	@Override
	public void preSolve(Contact contact, Manifold oldManifold) {
<span class="fc" id="L194">	}</span>

	@Override
	public void postSolve(Contact contact, ContactImpulse impulse) {
<span class="fc" id="L198">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>